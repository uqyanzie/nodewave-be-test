// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

// Declare schemas here
model User {
    id Int @id @default(autoincrement())
    email String @unique
    fullName String
    role Roles @default(USER)
    password String
    sales Sales[]
}

enum Roles {
    USER
    ADMIN
}
model Product {
    id Int @id @default(autoincrement())
    skuCode String @unique
    name String
    category String
    weight Float
    unit String @default("pcs")
    bottomPrice Float //bottom price per unit 
    salesItems SalesItem[]
}

enum ProductCategory {
    SPAREPART
    KIT
    ACCESSORIES
}

model Sales {
    id Int @id @default(autoincrement())
    sellerId Int
    seller User @relation(fields: [sellerId], references: [id])
    receiptNumber String
    transactionDate DateTime @db.Date
    transactionTime DateTime @db.Time()
    discount Float?
    totalPrice Float
    totalPriceDiscount Float
    salesItems SalesItem[]
}

model SalesItem {
    id Int @id @default(autoincrement())
    salesId Int
    productId Int 
    product Product @relation(fields: [productId], references: [id])
    sales Sales @relation(fields: [salesId], references: [id])
    quantity Int
    sellPrice Float
}

model TaskJob {
    id Int @id @default(autoincrement())
    taskIdentifier String
    payload Json?
    status String
    errorMessage String?
    createdAt DateTime @default(now())
    lastExecutionAt DateTime @default(now())
    retries Int @default(0)
    finishedAt DateTime?
    fileUpload FileUpload?
}

model FileUpload {
    id Int @id @default(autoincrement())
    jobId Int? @unique
    job TaskJob? @relation(fields: [jobId], references: [id])
    fileName String?
    taskIdentifier String
    status String
    fileUrl String
    uploadType UploadFileType?
    errRows Int? 
    errors Json?
    createdAt DateTime @default(now())
}

enum UploadFileType {
    FILE
    URL
}